<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Galeri - PMII</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .galeri-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* Maksimal 4 kolom */
    gap: 15px;
    }

    .galeri-item {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
    }

    .galeri-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }

    .galeri-meta {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }


    .galeri-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.4);
      color: white;
      padding: 5px 10px;
      font-size: 14px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .galeri-caption button {
      background: red;
      border: none;
      color: white;
      padding: 2px 6px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <div></div> <!-- dikosongkan untuk space -->
    <div class="logo-kanan">
        <div class="bulat-kuning"></div>
        <span href="index.html">PMII Makassar</span>
        <button class="logout-header-button" id="logout-btn" onclick="logoutUser()" style="display: none;">Logout</button>
    </div>
  </div>

  <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>

    <div class="sidebar-icons">
        <img src="icons/icon-beranda.png" class="sidebar-icon" id="dot-beranda" />
        <img src="icons/icon-tentang.png" class="sidebar-icon" id="dot-tentang" />
        <img src="icons/icon-kaderisasi.png" class="sidebar-icon" id="dot-kaderisasi" />
        <img src="icons/icon-persuratan.png" class="sidebar-icon" id="dot-persuratan" />
        <img src="icons/icon-berita.png" class="sidebar-icon" id="dot-berita" />
        <img src="icons/icon-galeri.png" class="sidebar-icon" id="dot-galeri" />
        <img src="icons/icon-anggota.png" class="sidebar-icon" id="dot-anggota" />
        <img src="icons/icon-diskusi.png" class="sidebar-icon" id="dot-ruang-diskusi" style="display: none;" />
        <img src="icons/icon-user.png" class="sidebar-icon" id="dot-login-user" />
        <img src="icons/icon-admin.png" class="sidebar-icon" id="dot-login-admin" />
        <img src="icons/icon-admin-panel.png" class="sidebar-icon" id="sidebar-dot" style="display: none;" />
    </div>
    <div class="sidebar" id="sidebar">
        <a href="index.html" class="sidebar-item">Beranda</a>
        <a href="#" class="sidebar-item" id="menu-tentang">Tentang PMII</a>
        <a href="#" class="sidebar-item" id="menu-kaderisasi">Kaderisasi</a>
        <a href="persuratan.html" class="sidebar-item" id="menu-persuratan">Persuratan</a>
        <a href="berita.html" class="sidebar-item">Berita</a>
        <a href="galeri.html" class="sidebar-item" id="menu-galeri">Galeri</a>
        <a href="#" class="sidebar-item" id="menu-anggota">Anggota</a>
        <a href="#" class="sidebar-item" id="menu-ruang-diskusi" id="obrolan" style="display: none;">Ruang Diskusi</a>
        <a href="login.html" class="sidebar-item" id="menu-login-user">Login User</a>
        <a href="admin_login.html   " class="sidebar-item">Login Admin</a>
        <a href="admin_panel.html" class="sidebar-item" id="menu-admin-panel" style="display: none;">Admin Panel</a>
    </div>

  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

  <!-- MAIN -->
  <div class="main-content">
    <div class="welcome-section">
      <h1 class="welcome-title">Galeri Foto Kegiatan</h1>

<form id="galeriForm" style="display: none; margin-bottom: 20px;">
  <input type="text" id="namaFoto" placeholder="Nama Foto" required />
  <div style="display:flex; gap:10px; align-items:center;">
    <label for="fotoInput" style="padding: 10px 20px; background: #2563eb; color: white; border-radius: 6px; font-weight: bold; cursor: pointer;">
      üì∑ Pilih Foto
    </label>
    <input type="file" id="fotoInput" accept="image/*" style="display:none;" />

    <select id="kategoriFoto">
      <option value="Kegiatan">Kegiatan</option>
      <option value="Seminar">Seminar</option>
      <option value="Rapat">Rapat</option>
    </select>
    <button type="submit" style="padding:10px 20px;">Upload</button>
  </div>
</form>

<div style="margin-bottom: 20px;">
  <input type="text" id="searchInput" placeholder="Cari foto..." style="padding:8px; width:100%;max-width:300px; border-radius:4px; border:1px solid #ccc;" />
</div>

<div class="galeri-grid" id="galeriGrid"></div>

<!-- Modal Preview -->
<div id="previewModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); align-items:center; justify-content:center;">
  <div style="position:relative; max-width:90%; max-height:90%;">
    <img id="previewImg" src="" alt="" style="max-width:100%; max-height:100%; border-radius:8px;" />
    <button id="closeModal" style="position:absolute; top:10px; right:10px; background:red; color:white; border:none; padding:6px 10px; border-radius:4px; cursor:pointer;">X</button>
  </div>
</div>


      <div class="galeri-grid" id="galeriGrid"></div>
    </div>
  </div>
  <script src="script.js"></script>
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
const supabase = createClient(SUPA_URL, SUPA_KEY);

document.addEventListener('DOMContentLoaded', () => {
  const isAdmin = localStorage.getItem('isAdmin') === 'true';
  const form = document.getElementById('galeriForm');
  const namaInput = document.getElementById('namaFoto');
  const fileInput = document.getElementById('fotoInput');
  const kategoriInput = document.getElementById('kategoriFoto');
  const dropZone = document.getElementById('dropZone');
  const grid = document.getElementById('galeriGrid');
  const searchInput = document.getElementById('searchInput');
  const modal = document.getElementById('previewModal');
  const previewImg = document.getElementById('previewImg');
  const closeModal = document.getElementById('closeModal');

  if (isAdmin) form.style.display = 'block';

  dropZone.addEventListener('click', () => fileInput.click());
  dropZone.addEventListener('dragover', e => e.preventDefault());
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    fileInput.files = e.dataTransfer.files;
    triggerChange();
  });

  fileInput.addEventListener('change', triggerChange);

  function triggerChange() {
    const name = fileInput.files[0]?.name || 'Belum ada foto';
    dropZone.textContent = name;
  }

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const nama = namaInput.value.trim();
    const file = fileInput.files[0];
    const kategori = kategoriInput.value;
    if (!nama || !file) return alert('Isi nama & pilih foto');

    const safeName = file.name.replace(/\s+/g, '_').replace(/[^\w.-]/g, '');
    const path = `${Date.now()}_${kategori}_${safeName}`;

    const { error: uploadErr } = await supabase
      .storage.from('galeri').upload(path, file, { cacheControl: '3600', upsert: false });
    if (uploadErr) return alert('Upload gagal: ' + uploadErr.message);

    const { data: urlData } = supabase.storage.from('galeri').getPublicUrl(path);
    const publicUrl = urlData.publicUrl;

    const { error: dbErr } = await supabase
      .from('galeri_list')
      .insert([{ nama, kategori, path, url: publicUrl }]);
    if (dbErr) return alert('Gagal tahan DB: ' + dbErr.message);

    namaInput.value = '';
    fileInput.value = '';
    triggerChange();
    kategoriInput.value = 'Kegiatan';
    renderGaleriList();
  });

  async function renderGaleriList() {
    const { data: list, error } = await supabase
      .from('galeri_list')
      .select('*')
      .order('uploaded_at', { ascending: false });
    if (error) return alert(error.message);

    const q = searchInput.value.toLowerCase();
    grid.innerHTML = '';
    list.filter(f => f.nama.toLowerCase().includes(q) || (f.kategori && f.kategori.toLowerCase().includes(q)))
      .forEach(f => {
        const div = document.createElement('div');
        div.className = 'galeri-item';
        div.innerHTML = `
          <img src="${f.url}" alt="${f.nama}" />
          <div class="galeri-caption">
            <span>${f.nama}</span>
            <button onclick="preview('${f.url}')">üîç</button>
            ${isAdmin ? `<button onclick="hapusFoto(${f.id}, '${f.path}')">üóëÔ∏è</button>` : ''}
          </div>
          <div class="galeri-meta">${f.kategori} ‚Äì ${new Date(f.uploaded_at).toLocaleDateString()}</div>`;
        grid.appendChild(div);
      });
  }

  searchInput.addEventListener('input', renderGaleriList);

  window.preview = url => {
    previewImg.src = url;
    modal.style.display = 'flex';
  };
  closeModal.addEventListener('click', () => modal.style.display = 'none');
  modal.addEventListener('click', e => { if (e.target===modal) modal.style.display='none'; });

  window.hapusFoto = async (id, path) => {
    if (!confirm('Hapus foto ini?')) return;
    const { error: delErr } = await supabase.storage.from('galeri').remove([path]);
    if (delErr) return alert(delErr.message);
    const { error: dbErr } = await supabase.from('galeri_list').delete().eq('id', id);
    if (dbErr) return alert(dbErr.message);
    renderGaleriList();
  };

  renderGaleriList();
});
</script>

</script>

</body>
</html>
